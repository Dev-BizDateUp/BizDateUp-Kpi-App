CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name TEXT UNIQUE
);

CREATE TABLE designations (
    id SERIAL PRIMARY KEY,
    name TEXT UNIQUE,
    department_id INTEGER,
    CONSTRAINT fk_designations_department FOREIGN KEY (department_id)
        REFERENCES departments (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION
);

CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    employee_id TEXT UNIQUE,
    name TEXT NOT NULL,
    department_id INTEGER,
    designation_id INTEGER,
    company TEXT,
    employee_type TEXT,
    phone TEXT,
    email TEXT,
    image TEXT,
    status TEXT,
    CONSTRAINT fk_employees_department FOREIGN KEY (department_id)
        REFERENCES departments (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION,
    CONSTRAINT fk_employees_designation FOREIGN KEY (designation_id)
        REFERENCES designations (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION
);

CREATE TABLE kpi_frequencies (
    id SERIAL PRIMARY KEY,
    name TEXT UNIQUE
);

CREATE TABLE kpi_periods (
    id SERIAL PRIMARY KEY,
    frequency_id INTEGER,
    year INTEGER NOT NULL,
    month INTEGER,
    week INTEGER,
    quarter INTEGER,
    start_date DATE,
    end_date DATE,
    CONSTRAINT fk_kpi_periods_frequency FOREIGN KEY (frequency_id)
        REFERENCES kpi_frequencies (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION
);

CREATE TABLE kpis (
    id SERIAL PRIMARY KEY,
    title TEXT NOT NULL,
    description TEXT,
    frequency_id INTEGER,
    target DOUBLE PRECISION,
    designation_id INTEGER,
    green_threshold DOUBLE PRECISION,
    yellow_threshold DOUBLE PRECISION,
    CONSTRAINT fk_kpis_frequency FOREIGN KEY (frequency_id)
        REFERENCES kpi_frequencies (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION,
    CONSTRAINT fk_kpis_designation FOREIGN KEY (designation_id)
        REFERENCES designations (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION
);

CREATE TABLE kpi_values (
    id SERIAL PRIMARY KEY,
    kpi_id INTEGER,
    employee_id INTEGER,
    period_id INTEGER,
    value_achieved DOUBLE PRECISION NOT NULL,
    CONSTRAINT fk_kpi_values_kpi FOREIGN KEY (kpi_id)
        REFERENCES kpis (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION,
    CONSTRAINT fk_kpi_values_employee FOREIGN KEY (employee_id)
        REFERENCES employees (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION,
    CONSTRAINT fk_kpi_values_period FOREIGN KEY (period_id)
        REFERENCES kpi_periods (id)
        ON DELETE NO ACTION
        ON UPDATE NO ACTION
);
